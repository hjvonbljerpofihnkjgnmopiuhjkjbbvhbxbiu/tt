<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Récapitulatif Employés</title>
</head>
<body>

    <h1>Récapitulatif Employés</h1>
    
    <!-- Résultats RoxWood -->
    <div>
        <h2>RoxWood</h2>
        <p>Nombre de factures: <span id="factures-roxwood"></span></p>
        <p>Chiffre d'affaires: <span id="chiffre-roxwood"></span></p>
        <p>Prix usine: <span id="prix-roxwood"></span></p>
        <p>Bénéfice brut: <span id="benefice-brut-roxwood"></span></p>
        <p>Bénéfice net: <span id="benefice-net-roxwood"></span></p>
    </div>

    <!-- Résultats Paletot -->
    <div>
        <h2>Paletot</h2>
        <p>Nombre de factures: <span id="factures-paletot"></span></p>
        <p>Chiffre d'affaires: <span id="chiffre-paletot"></span></p>
        <p>Prix usine: <span id="prix-paletot"></span></p>
        <p>Bénéfice brut: <span id="benefice-brut-paletot"></span></p>
        <p>Bénéfice net: <span id="benefice-net-paletot"></span></p>
    </div>

    <script>
        // Fonction pour récupérer les données des Google Sheets
        async function fetchGoogleSheetData(sheetId, range) {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=AIzaSyBpcBw4PhPUq7k5FdkfzvMyRxEyCjmpkK0`;
            const response = await fetch(url);
            const data = await response.json();
            return data.values;
        }

        // Fonction principale pour traiter les données
        async function processEmployeeData() {
            const sheetId = "1M19pAtJYNnDCaKxhO5XjWIlxqT7p2zvk6FHqKYVBJ1g";

            // Récupérer les données des deux tableaux
            const tableau1 = await fetchGoogleSheetData(sheetId, 'Employé!D3:W32');
            const tableau2 = await fetchGoogleSheetData(sheetId, 'Dashboard!B6:W35');

            // Initialiser les variables de calcul pour RoxWood et Paletot
            let facturesRoxwood = 0, chiffreRoxwood = 0, prixUsineRoxwood = 0, beneficeBrutRoxwood = 0, salaireRoxwood = 0;
            let facturesPaletot = 0, chiffrePaletot = 0, prixUsinePaletot = 0, beneficeBrutPaletot = 0, salairePaletot = 0;

            // Parcourir le tableau 1 pour trouver les employés RoxWood et Paletot
            for (let i = 0; i < tableau1.length; i++) {
                const employeId = tableau1[i][0]; // Identifiant de l'employé (Colonne D)
                const isRoxwood = tableau1[i][19] === 'TRUE'; // Boolean RoxWood ou Paletot (Colonne W)

                // Trouver les données correspondantes dans le tableau 2
                const employeData = tableau2.find(row => row[2] === employeId); // Colonne C dans tableau 2
                if (employeData) {
                    const factures = parseFloat(employeData[4]) || 0; // Colonne E
                    const chiffreAffaire = parseFloat(employeData[5]) || 0; // Colonne F
                    const prixUsine = parseFloat(employeData[7]) || 0; // Colonne H
                    const benefice = parseFloat(employeData[9]) || 0; // Colonne J
                    const salaire = parseFloat(employeData[22]) || 0; // Colonne W

                    if (isRoxwood) {
                        facturesRoxwood += factures;
                        chiffreRoxwood += chiffreAffaire;
                        prixUsineRoxwood += prixUsine;
                        beneficeBrutRoxwood += benefice;
                        salaireRoxwood += salaire;
                    } else {
                        facturesPaletot += factures;
                        chiffrePaletot += chiffreAffaire;
                        prixUsinePaletot += prixUsine;
                        beneficeBrutPaletot += benefice;
                        salairePaletot += salaire;
                    }
                }
            }

            // Calculer les bénéfices nets
            const beneficeNetRoxwood = beneficeBrutRoxwood - salaireRoxwood;
            const beneficeNetPaletot = beneficeBrutPaletot - salairePaletot;

            // Mettre à jour le DOM avec les résultats RoxWood
            document.getElementById('factures-roxwood').textContent = facturesRoxwood;
            document.getElementById('chiffre-roxwood').textContent = chiffreRoxwood;
            document.getElementById('prix-roxwood').textContent = prixUsineRoxwood;
            document.getElementById('benefice-brut-roxwood').textContent = beneficeBrutRoxwood;
            document.getElementById('benefice-net-roxwood').textContent = beneficeNetRoxwood;

            // Mettre à jour le DOM avec les résultats Paletot
            document.getElementById('factures-paletot').textContent = facturesPaletot;
            document.getElementById('chiffre-paletot').textContent = chiffrePaletot;
            document.getElementById('prix-paletot').textContent = prixUsinePaletot;
            document.getElementById('benefice-brut-paletot').textContent = beneficeBrutPaletot;
            document.getElementById('benefice-net-paletot').textContent = beneficeNetPaletot;
        }

        // Appeler la fonction principale après le chargement de la page
        window.onload = processEmployeeData;
    </script>

</body>
</html>
