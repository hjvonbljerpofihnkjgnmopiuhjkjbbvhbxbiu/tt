<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapport RoxWood et Paleto</title>
    <script>
        // Remplacer par votre clé API Google et ID de la feuille
        const apiKey = 'YOUR_API_KEY';
        const sheetId = '1M19pAtJYNnDCaKxhO5XjWIlxqT7p2zvk6FHqKYVBJ1g';

        // Récupérer les données depuis Google Sheets
        async function getData(range) {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`;
            const response = await fetch(url);
            const data = await response.json();
            return data.values;
        }

        // Additionner les colonnes des employés de RoxWood ou Paleto
        async function calculateData(isRoxWood) {
            // Récupérer les données des deux tableaux
            const tableau1 = await getData('Employé!D3:W32');
            const tableau2 = await getData('Dashboard!B6:W35');

            // Filtrer les employés en fonction du boolean (Colonne W dans Tableau1)
            const filteredEmployees = tableau1.filter(row => {
                const isRoxWoodEmployee = row[19] === 'TRUE';  // Colonne W (Index 19)
                return isRoxWood ? isRoxWoodEmployee : !isRoxWoodEmployee;
            });

            // Récupérer les identifiants des employés filtrés (Colonne D dans Tableau1)
            const employeeIds = filteredEmployees.map(row => row[0]);

            // Initialisation des totaux
            let totalFactures = 0;
            let totalChiffreAffaire = 0;
            let totalPrixUsine = 0;
            let totalBeneficeBrut = 0;
            let totalSalaires = 0;

            // Boucler sur les employés du Tableau2 et faire les additions
            tableau2.forEach(row => {
                const employeeId = row[2]; // Colonne C (Index 2) dans Tableau2
                if (employeeIds.includes(employeeId)) {
                    totalFactures += parseFloat(row[4] || 0);         // Colonne E (Index 4)
                    totalChiffreAffaire += parseFloat(row[5] || 0);   // Colonne F (Index 5)
                    totalPrixUsine += parseFloat(row[7] || 0);        // Colonne H (Index 7)
                    totalBeneficeBrut += parseFloat(row[9] || 0);     // Colonne J (Index 9)
                    totalSalaires += parseFloat(row[22] || 0);        // Colonne W (Index 22)
                }
            });

            // Calcul du bénéfice net
            const totalBeneficeNet = totalBeneficeBrut - totalSalaires;

            // Affichage des résultats dans les divs correspondantes
            document.getElementById(isRoxWood ? 'facturesRoxWood' : 'facturesPaleto').innerText = totalFactures;
            document.getElementById(isRoxWood ? 'chiffreAffaireRoxWood' : 'chiffreAffairePaleto').innerText = totalChiffreAffaire;
            document.getElementById(isRoxWood ? 'prixUsineRoxWood' : 'prixUsinePaleto').innerText = totalPrixUsine;
            document.getElementById(isRoxWood ? 'beneficeBrutRoxWood' : 'beneficeBrutPaleto').innerText = totalBeneficeBrut;
            document.getElementById(isRoxWood ? 'beneficeNetRoxWood' : 'beneficeNetPaleto').innerText = totalBeneficeNet;
        }

        // Charger les données pour RoxWood et Paleto
        async function loadData() {
            await calculateData(true);  // Pour RoxWood
            await calculateData(false); // Pour Paleto
        }

        // Charger les données lorsque la page est prête
        window.onload = loadData;
    </script>
</head>
<body>
    <h1>Rapport Employés RoxWood et Paleto</h1>

    <div>
        <h2>RoxWood</h2>
        <p>Factures: <span id="facturesRoxWood"></span></p>
        <p>Chiffre d'affaire: <span id="chiffreAffaireRoxWood"></span></p>
        <p>Prix Usine: <span id="prixUsineRoxWood"></span></p>
        <p>Bénéfice Brut: <span id="beneficeBrutRoxWood"></span></p>
        <p>Bénéfice Net: <span id="beneficeNetRoxWood"></span></p>
    </div>

    <div>
        <h2>Paleto</h2>
        <p>Factures: <span id="facturesPaleto"></span></p>
        <p>Chiffre d'affaire: <span id="chiffreAffairePaleto"></span></p>
        <p>Prix Usine: <span id="prixUsinePaleto"></span></p>
        <p>Bénéfice Brut: <span id="beneficeBrutPaleto"></span></p>
        <p>Bénéfice Net: <span id="beneficeNetPaleto"></span></p>
    </div>
</body>
</html>
