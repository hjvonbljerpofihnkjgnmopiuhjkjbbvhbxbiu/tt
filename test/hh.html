






<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calcul des bénéfices - RoxWood vs Paletot</title>
    <style>
        /* Dark theme styling */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #121212;
            color: #f1f1f1;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #333;
            background-color: #1e1e1e;
        }
        h1, h2 {
            color: #f1f1f1;
        }
        canvas {
            margin-top: 20px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <h1>Calcul des bénéfices</h1>
    
    <h2>RoxWood</h2>
    <div id="roxwood-factures" class="result"></div>
    <div id="roxwood-chiffre-affaire" class="result"></div>
    <div id="roxwood-prix-usine" class="result"></div>
    <div id="roxwood-benefice-brut" class="result"></div>
    <div id="roxwood-salaires" class="result"></div>
    <div id="roxwood-benefice-net" class="result"></div>

    <h2>Paletot</h2>
    <div id="paletot-factures" class="result"></div>
    <div id="paletot-chiffre-affaire" class="result"></div>
    <div id="paletot-prix-usine" class="result"></div>
    <div id="paletot-benefice-brut" class="result"></div>
    <div id="paletot-salaires" class="result"></div>
    <div id="paletot-benefice-net" class="result"></div>

    <h2>Graphiques</h2>
    <canvas id="beneficeChart"></canvas>

    <script>
        const apiKey = 'AIzaSyBpcBw4PhPUq7k5FdkfzvMyRxEyCjmpkK0'; // Remplacez par votre clé API
        const spreadsheetId = '1M19pAtJYNnDCaKxhO5XjWIlxqT7p2zvk6FHqKYVBJ1g';

        // Fonction pour récupérer les données de Google Sheets
        async function fetchSheetData(range) {
            const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`);
            const data = await response.json();
            console.log(`Données récupérées pour la plage ${range}:`, data.values); // Log des données brutes
            return data.values;
        }

        // Fonction pour convertir une valeur formatée en milliers avec espaces en float
        function parseFormattedValue(value) {
            return parseFloat(value.replace(/\s/g, '') || 0);
        }

        // Fonction principale pour traiter les données
        async function processData() {
            // Récupérer les données des deux tableaux
            const tableau1 = await fetchSheetData('Employé!D4:W43');
            const tableau2 = await fetchSheetData('Dashboard!C6:W45');

            let roxwoodFactures = 0, roxwoodChiffreAffaire = 0, roxwoodPrixUsine = 0, roxwoodBeneficeBrut = 0, roxwoodSalaires = 0;
            let paletotFactures = 0, paletotChiffreAffaire = 0, paletotPrixUsine = 0, paletotBeneficeBrut = 0, paletotSalaires = 0;

            const roxwoodIds = [];
            const paletotIds = [];

            // Séparer les employés Roxwood et Paletot en fonction du boolean (colonne W)
            tableau1.forEach((row, index) => {
                const employeId = row[0]; // Colonne D (Index 0)
                const isRoxwood = row[19] === 'TRUE'; // Colonne W (Index 19)

                if (isRoxwood) {
                    roxwoodIds.push(employeId);
                } else {
                    paletotIds.push(employeId);
                }
                console.log(`Employé ${index + 1} - ID: ${employeId}, Roxwood: ${isRoxwood}`); // Log des employés
            });

            console.log('Identifiants employés Roxwood:', roxwoodIds);
            console.log('Identifiants employés Paletot:', paletotIds);

            // Traiter les données du tableau 2 pour chaque employé
            tableau2.forEach((row, index) => {
                const employeId = row[0]; // Colonne C (Index 2)
                const factures = parseFormattedValue(row[2]) || 0; // Colonne E (Index 4)
                const chiffreAffaire = parseFormattedValue(row[3]) || 0; // Colonne F (Index 5)
                const prixUsine = parseFormattedValue(row[5]) || 0; // Colonne H (Index 7)
                const beneficeBrut = parseFormattedValue(row[7]) || 0; // Colonne J (Index 9)
                const salaire = parseFormattedValue(row[20]) || 0; // Colonne W (Index 22)

                // Vérifier si l'employé appartient à Roxwood ou Paletot
                if (roxwoodIds.includes(employeId)) {
                    console.log(`Roxwood - Employé ${employeId}, Factures: ${factures}, Chiffre d'affaire: ${chiffreAffaire}, Prix Usine: ${prixUsine}, Bénéfice Brut: ${beneficeBrut}, Salaire: ${salaire}`);
                    roxwoodFactures += factures;
                    roxwoodChiffreAffaire += chiffreAffaire;
                    roxwoodPrixUsine += prixUsine;
                    roxwoodBeneficeBrut += beneficeBrut;
                    roxwoodSalaires += salaire;
                } else if (paletotIds.includes(employeId)) {
                    console.log(`Paletot - Employé ${employeId}, Factures: ${factures}, Chiffre d'affaire: ${chiffreAffaire}, Prix Usine: ${prixUsine}, Bénéfice Brut: ${beneficeBrut}, Salaire: ${salaire}`);
                    paletotFactures += factures;
                    paletotChiffreAffaire += chiffreAffaire;
                    paletotPrixUsine += prixUsine;
                    paletotBeneficeBrut += beneficeBrut;
                    paletotSalaires += salaire;
                }
            });

            // Calcul des bénéfices nets
            const roxwoodBeneficeNet = roxwoodBeneficeBrut - roxwoodSalaires;
            const paletotBeneficeNet = paletotBeneficeBrut - paletotSalaires;

            // Logs des résultats finaux pour Roxwood
            console.log('=== Roxwood ===');
            console.log('Total des factures:', roxwoodFactures);
            console.log('Chiffre d\'affaire:', roxwoodChiffreAffaire);
            console.log('Prix usine:', roxwoodPrixUsine);
            console.log('Bénéfice brut:', roxwoodBeneficeBrut);
            console.log('Salaires:', roxwoodSalaires);
            console.log('Bénéfice net:', roxwoodBeneficeNet);

            // Logs des résultats finaux pour Paletot
            console.log('=== Paletot ===');
            console.log('Total des factures:', paletotFactures);
            console.log('Chiffre d\'affaire:', paletotChiffreAffaire);
            console.log('Prix usine:', paletotPrixUsine);
            console.log('Bénéfice brut:', paletotBeneficeBrut);
            console.log('Salaires:', paletotSalaires);
            console.log('Bénéfice net:', paletotBeneficeNet);

            // Affichage des résultats dans la page HTML pour Roxwood
            document.getElementById('roxwood-factures').innerText = `Total des factures: ${roxwoodFactures}`;
            document.getElementById('roxwood-chiffre-affaire').innerText = `Chiffre d'affaire: ${roxwoodChiffreAffaire}`;
            document.getElementById('roxwood-prix-usine').innerText = `Prix usine: ${roxwoodPrixUsine}`;
            document.getElementById('roxwood-benefice-brut').innerText = `Bénéfice brut: ${roxwoodBeneficeBrut}`;
            document.getElementById('roxwood-salaires').innerText = `Salaires: ${roxwoodSalaires}`;
            document.getElementById('roxwood-benefice-net').innerText = `Bénéfice net: ${roxwoodBeneficeNet}`;

            // Affichage des résultats dans la page HTML pour Paletot
            document.getElementById('paletot-factures').innerText = `Total des factures: ${paletotFactures}`;
            document.getElementById('paletot-chiffre-affaire').innerText = `Chiffre d'affaire: ${paletotChiffreAffaire}`;
            document.getElementById('paletot-prix-usine').innerText = `Prix usine: ${paletotPrixUsine}`;
            document.getElementById('paletot-benefice-brut').innerText = `Bénéfice brut: ${paletotBeneficeBrut}`;
            document.getElementById('paletot-salaires').innerText = `Salaires: ${paletotSalaires}`;
            document.getElementById('paletot-benefice-net').innerText = `Bénéfice net: ${paletotBeneficeNet}`;

            // Création du graphique avec Chart.js
            const ctx = document.getElementById('beneficeChart').getContext('2d');
            const beneficeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['RoxWood', 'Paletot'],
                    datasets: [
                        {
                            label: 'Factures',
                            data: [roxwoodFactures, paletotFactures],
                            backgroundColor: 'rgba(255, 99, 132, 0.5)',
                        },
                        {
                            label: 'Chiffre d\'affaire',
                            data: [roxwoodChiffreAffaire, paletotChiffreAffaire],
                            backgroundColor: 'rgba(54, 162, 235, 0.5)',
                        },
                        {
                            label: 'Bénéfice brut',
                            data: [roxwoodBeneficeBrut, paletotBeneficeBrut],
                            backgroundColor: 'rgba(75, 192, 192, 0.5)',
                        },
                        {
                            label: 'Bénéfice net',
                            data: [roxwoodBeneficeNet, paletotBeneficeNet],
                            backgroundColor: 'rgba(153, 102, 255, 0.5)',
                        },
                        {
                            label: 'Salaires',
                            data: [roxwoodSalaires, paletotSalaires],
                            backgroundColor: 'rgba(255, 159, 64, 0.5)',
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Lancer le traitement des données au chargement de la page
        processData();
    </script>

</body>
</html>
