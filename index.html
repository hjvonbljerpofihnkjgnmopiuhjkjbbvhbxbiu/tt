<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets API - Affichage</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid black;
            padding: 10px;
            text-align: center;
        }
        td {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Affichage du Google Sheet Partenaire</h1>
    <div id="table-container"></div>

    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        const SHEET_ID = '1M19pAtJYNnDCaKxhO5XjWIlxqT7p2zvk6FHqKYVBJ1g';
        const API_KEY = 'AIzaSyBpcBw4PhPUq7k5FdkfzvMyRxEyCjmpkK0';
        const RANGE = 'Partenaires!B2:J25';

        function initClient() {
            gapi.client.init({
                'apiKey': API_KEY
            }).then(function() {
                return gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SHEET_ID,
                    range: RANGE
                });
            }).then(function(response) {
                const values = response.result.values;
                if (values.length > 0) {
                    generateTable(values);
                } else {
                    console.log("Pas de données trouvées.");
                }
            }, function(response) {
                console.error('Erreur: ' + response.result.error.message);
            });
        }

        function generateTable(data) {
            const tableContainer = document.getElementById('table-container');
            const table = document.createElement('table');
            const tbody = document.createElement('tbody');

            data.forEach((row, rowIndex) => {
                const tr = document.createElement('tr');
                row.forEach((cell, colIndex) => {
                    const td = document.createElement('td');
                    td.textContent = cell;

                    if (colIndex >= 3 && colIndex <= 8 && rowIndex > 0) {  // Colonnes D à I
                        td.addEventListener('click', function() {
                            handleCellClick(rowIndex + 2, colIndex + 2, data);
                        });
                    }

                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });

            table.appendChild(tbody);
            tableContainer.appendChild(table);
        }

        function handleCellClick(row, col, data) {
            // Récupérer les valeurs des cellules nécessaires
            const valueC = data[row - 2][1]; // Colonne C (B est index 1 dans l'array)
            const valueTop = data[1][col - 2]; // Ligne 3 colonne du clic (D, E, F...)

            const result = `${valueC} ${valueTop}`;
            copyToClipboard(result);
        }

        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            alert(`Valeur copiée: ${text}`);
        }

        gapi.load('client', initClient);
    </script>
</body>
</html>
