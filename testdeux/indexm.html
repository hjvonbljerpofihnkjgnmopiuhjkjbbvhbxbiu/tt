<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyse des Employés - RoxWood et Paleto</title>
</head>
<body>

    <h1>Analyse des Employés de RoxWood et Paleto</h1>

    <div id="roxwood-results">
        <h2>RoxWood</h2>
        <div>Total Factures: <span id="roxwood-factures"></span></div>
        <div>Chiffre d'Affaires: <span id="roxwood-ca"></span></div>
        <div>Chiffre d'Achat: <span id="roxwood-achat"></span></div>
        <div>Bénéfice Brut: <span id="roxwood-benefice-brut"></span></div>
        <div>Bénéfice Net: <span id="roxwood-benefice-net"></span></div>
    </div>

    <div id="paleto-results">
        <h2>Paleto</h2>
        <div>Total Factures: <span id="paleto-factures"></span></div>
        <div>Chiffre d'Affaires: <span id="paleto-ca"></span></div>
        <div>Chiffre d'Achat: <span id="paleto-achat"></span></div>
        <div>Bénéfice Brut: <span id="paleto-benefice-brut"></span></div>
        <div>Bénéfice Net: <span id="paleto-benefice-net"></span></div>
    </div>

    <script>
        // URLs des CSV Google Sheets
        const urlTableau1 = 'https://docs.google.com/spreadsheets/d/1C9HySR7QsHFbGVLgSL1AliO0IANVKt0fOAT9s79WTYA/export?format=csv&gid=821726330';
        const urlTableau2 = 'https://docs.google.com/spreadsheets/d/1M19pAtJYNnDCaKxhO5XjWIlxqT7p2zvk6FHqKYVBJ1g/export?format=csv&gid=582059801';

        // Fonction pour charger un CSV depuis une URL et le convertir en tableau
        async function loadCSV(url) {
            const response = await fetch(url);
            const text = await response.text();
            return text.split('\n').map(row => row.split(','));
        }

        // Fonction principale pour traiter les données et afficher les résultats
        async function processData() {
            const tableau1 = await loadCSV(urlTableau1);
            const tableau2 = await loadCSV(urlTableau2);

            // Récupérer les identifiants des employés de RoxWood et Paleto
            const roxwoodIds = [];
            const paletoIds = [];

            tableau1.slice(2).forEach(row => {
                const employeeId = row[3];
                const isRoxwood = row[22] === 'TRUE';
                if (isRoxwood) {
                    roxwoodIds.push(employeeId);
                } else {
                    paletoIds.push(employeeId);
                }
            });

            // Initialiser les sommes pour RoxWood et Paleto
            let roxwoodFactures = 0, roxwoodCA = 0, roxwoodAchat = 0, roxwoodBeneficeBrut = 0, roxwoodSalaries = 0;
            let paletoFactures = 0, paletoCA = 0, paletoAchat = 0, paletoBeneficeBrut = 0, paletoSalaries = 0;

            // Calculer les sommes en parcourant le tableau 2
            tableau2.slice(5).forEach(row => {
                const employeeId = row[2];
                const factures = parseFloat(row[4]) || 0;
                const ca = parseFloat(row[5]) || 0;
                const achat = parseFloat(row[7]) || 0;
                const benefice = parseFloat(row[9]) || 0;
                const salaire = parseFloat(row[22]) || 0;

                if (roxwoodIds.includes(employeeId)) {
                    roxwoodFactures += factures;
                    roxwoodCA += ca;
                    roxwoodAchat += achat;
                    roxwoodBeneficeBrut += benefice;
                    roxwoodSalaries += salaire;
                } else if (paletoIds.includes(employeeId)) {
                    paletoFactures += factures;
                    paletoCA += ca;
                    paletoAchat += achat;
                    paletoBeneficeBrut += benefice;
                    paletoSalaries += salaire;
                }
            });

            // Calcul des bénéfices nets
            const roxwoodBeneficeNet = roxwoodBeneficeBrut - roxwoodSalaries;
            const paletoBeneficeNet = paletoBeneficeBrut - paletoSalaries;

            // Afficher les résultats pour RoxWood
            document.getElementById('roxwood-factures').textContent = roxwoodFactures;
            document.getElementById('roxwood-ca').textContent = roxwoodCA;
            document.getElementById('roxwood-achat').textContent = roxwoodAchat;
            document.getElementById('roxwood-benefice-brut').textContent = roxwoodBeneficeBrut;
            document.getElementById('roxwood-benefice-net').textContent = roxwoodBeneficeNet;

            // Afficher les résultats pour Paleto
            document.getElementById('paleto-factures').textContent = paletoFactures;
            document.getElementById('paleto-ca').textContent = paletoCA;
            document.getElementById('paleto-achat').textContent = paletoAchat;
            document.getElementById('paleto-benefice-brut').textContent = paletoBeneficeBrut;
            document.getElementById('paleto-benefice-net').textContent = paletoBeneficeNet;
        }

        // Charger et traiter les données au chargement de la page
        window.onload = processData;
    </script>

</body>
</html>
