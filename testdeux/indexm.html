<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employés RoxWood et Paleto</title>
    <style>
        .results {
            margin: 20px;
            padding: 10px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>

    <h1>Résultats pour RoxWood</h1>
    <div class="results" id="roxwood-factures">Factures Total: </div>
    <div class="results" id="roxwood-chiffre-affaire">Chiffre d'affaire Total: </div>
    <div class="results" id="roxwood-chiffre-achat">Chiffre d'achat Total: </div>
    <div class="results" id="roxwood-benefice-brut">Bénéfice Brut: </div>
    <div class="results" id="roxwood-benefice-net">Bénéfice Net: </div>

    <h1>Résultats pour Paleto</h1>
    <div class="results" id="paleto-factures">Factures Total: </div>
    <div class="results" id="paleto-chiffre-affaire">Chiffre d'affaire Total: </div>
    <div class="results" id="paleto-chiffre-achat">Chiffre d'achat Total: </div>
    <div class="results" id="paleto-benefice-brut">Bénéfice Brut: </div>
    <div class="results" id="paleto-benefice-net">Bénéfice Net: </div>

    <script>
        // URLs des fichiers CSV
        //const tableau1Url = 'https://docs.google.com/spreadsheets/d/1M19pAtJYNnDCaKxhO5XjWIlxqT7p2zvk6FHqKYVBJ1g/export?format=csv&gid=821726330';
        //const tableau2Url = 'https://docs.google.com/spreadsheets/d/1M19pAtJYNnDCaKxhO5XjWIlxqT7p2zvk6FHqKYVBJ1g/export?format=csv&gid=582059801';
// URLs des tableaux Google Sheets
const tableau1Url = 'https://docs.google.com/spreadsheets/d/13d4Y9xWXVuQVHhLZXh65Y8KeHKs0N3X_c-9py_ss_9Q/export?format=csv&gid=821726330';
const tableau2Url = 'https://docs.google.com/spreadsheets/d/1M19pAtJYNnDCaKxhO5XjWIlxqT7p2zvk6FHqKYVBJ1g/export?format=csv&gid=582059801';

        // Fonctions pour analyser les données et afficher les résultats
        async function fetchAndProcessData() {
            console.log("Début de la récupération des données des tableaux.");

            // Récupérer les données des deux tableaux
            const [tableau1Data, tableau2Data] = await Promise.all([
                fetch(tableau1Url).then(response => response.text()),
                fetch(tableau2Url).then(response => response.text())
            ]);

            console.log("Données des tableaux récupérées avec succès.");

            // Convertir les CSV en tableau
            const tableau1 = tableau1Data.split('\n').slice(2, 42).map(row => row.split(','));
            const tableau2 = tableau2Data.split('\n').slice(5, 45).map(row => row.split(','));

            // Extraire les identifiants des employés de RoxWood et Paleto
            const employeesRoxWood = tableau1.filter(row => row[19] === 'TRUE').map(row => row[0]);
            const employeesPaleto = tableau1.filter(row => row[19] === 'FALSE').map(row => row[0]);

            console.log("Employés de RoxWood:", employeesRoxWood);
            console.log("Employés de Paleto:", employeesPaleto);

            // Initialiser les totaux
            let roxwoodData = { factures: 0, chiffreAffaire: 0, achat: 0, beneficeBrut: 0, salaires: 0 };
            let paletoData = { factures: 0, chiffreAffaire: 0, achat: 0, beneficeBrut: 0, salaires: 0 };

            // Calculer les totaux pour RoxWood et Paleto
            tableau2.forEach(row => {
                const identifiant = row[2];
                if (employeesRoxWood.includes(identifiant)) {
                    roxwoodData.factures += parseFloat(row[4]) || 0;
                    roxwoodData.chiffreAffaire += parseFloat(row[5]) || 0;
                    roxwoodData.achat += parseFloat(row[7]) || 0;
                    roxwoodData.beneficeBrut += parseFloat(row[9]) || 0;
                    roxwoodData.salaires += parseFloat(row[22]) || 0;
                }
                if (employeesPaleto.includes(identifiant)) {
                    paletoData.factures += parseFloat(row[4]) || 0;
                    paletoData.chiffreAffaire += parseFloat(row[5]) || 0;
                    paletoData.achat += parseFloat(row[7]) || 0;
                    paletoData.beneficeBrut += parseFloat(row[9]) || 0;
                    paletoData.salaires += parseFloat(row[22]) || 0;
                }
            });

            // Calcul des bénéfices nets
            roxwoodData.beneficeNet = roxwoodData.beneficeBrut - roxwoodData.salaires;
            paletoData.beneficeNet = paletoData.beneficeBrut - paletoData.salaires;

            console.log("Données calculées pour RoxWood:", roxwoodData);
            console.log("Données calculées pour Paleto:", paletoData);

            // Afficher les résultats pour RoxWood
            document.getElementById('roxwood-factures').textContent += roxwoodData.factures;
            document.getElementById('roxwood-chiffre-affaire').textContent += roxwoodData.chiffreAffaire;
            document.getElementById('roxwood-chiffre-achat').textContent += roxwoodData.achat;
            document.getElementById('roxwood-benefice-brut').textContent += roxwoodData.beneficeBrut;
            document.getElementById('roxwood-benefice-net').textContent += roxwoodData.beneficeNet;

            // Afficher les résultats pour Paleto
            document.getElementById('paleto-factures').textContent += paletoData.factures;
            document.getElementById('paleto-chiffre-affaire').textContent += paletoData.chiffreAffaire;
            document.getElementById('paleto-chiffre-achat').textContent += paletoData.achat;
            document.getElementById('paleto-benefice-brut').textContent += paletoData.beneficeBrut;
            document.getElementById('paleto-benefice-net').textContent += paletoData.beneficeNet;
        }

        // Appeler la fonction pour démarrer le traitement
        fetchAndProcessData().catch(error => console.error('Erreur lors du traitement des données:', error));
    </script>

</body>
</html>
