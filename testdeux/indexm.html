<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Affichage des Employés</title>
</head>
<body>

    <h2>RoxWood Résultats</h2>
    <div id="roxwood-invoices"></div>
    <div id="roxwood-revenue"></div>
    <div id="roxwood-expenses"></div>
    <div id="roxwood-gross-profit"></div>
    <div id="roxwood-net-profit"></div>

    <h2>Paleto Résultats</h2>
    <div id="paleto-invoices"></div>
    <div id="paleto-revenue"></div>
    <div id="paleto-expenses"></div>
    <div id="paleto-gross-profit"></div>
    <div id="paleto-net-profit"></div>

    <script>
        // Fonction pour récupérer les données d'un CSV
        async function fetchCSV(url) {
            console.log(`Fetching data from: ${url}`);
            const response = await fetch(url);
            const data = await response.text();
            return data.split('\n').map(row => row.split(','));
        }

        // Fonction principale pour le traitement des données
        async function processEmployeeData() {
            const tableau1URL = 'https://docs.google.com/spreadsheets/d/13d4Y9xWXVuQVHhLZXh65Y8KeHKs0N3X_c-9py_ss_9Q/export?format=csv&gid=821726330';
            const tableau2URL = 'https://docs.google.com/spreadsheets/d/1M19pAtJYNnDCaKxhO5XjWIlxqT7p2zvk6FHqKYVBJ1g/export?format=csv&gid=582059801';

            const tableau1 = await fetchCSV(tableau1URL);
            const tableau2 = await fetchCSV(tableau2URL);

            console.log('Tableau 1 récupéré avec succès:', tableau1);
            console.log('Tableau 2 récupéré avec succès:', tableau2);

            const roxwoodIds = [];
            const paletoIds = [];

            // Récupérer les IDs des employés en fonction du boolean dans tableau1
            tableau1.forEach(row => {
                const employeeId = row[3]; // Colonne D
                const isRoxWood = row[22] === 'TRUE'; // Colonne W
                if (isRoxWood) {
                    roxwoodIds.push(employeeId);
                } else {
                    paletoIds.push(employeeId);
                }
            });

            console.log('IDs RoxWood:', roxwoodIds);
            console.log('IDs Paleto:', paletoIds);

            // Initialiser les variables de calcul pour RoxWood et Paleto
            let roxwoodResults = { invoices: 0, revenue: 0, expenses: 0, grossProfit: 0, salaries: 0 };
            let paletoResults = { invoices: 0, revenue: 0, expenses: 0, grossProfit: 0, salaries: 0 };

            // Fonction pour calculer les résultats en fonction des IDs
            function calculateResults(employeeIds, results) {
                tableau2.forEach(row => {
                    const employeeId = row[2]; // Colonne C
                    if (employeeIds.includes(employeeId)) {
                        results.invoices += parseFloat(row[4]) || 0; // Colonne E - Nombre de factures
                        results.revenue += parseFloat(row[5]) || 0; // Colonne F - Chiffre d'affaire généré
                        results.expenses += parseFloat(row[7]) || 0; // Colonne H - Chiffre d'achat
                        results.grossProfit += parseFloat(row[9]) || 0; // Colonne J - Bénéfice
                        results.salaries += parseFloat(row[22]) || 0; // Colonne W - Salaires
                    }
                });
                console.log(`Résultats calculés pour les employés:`, results);
            }

            // Calculer les résultats pour RoxWood
            calculateResults(roxwoodIds, roxwoodResults);

            // Calculer les résultats pour Paleto
            calculateResults(paletoIds, paletoResults);

            // Afficher les résultats dans les div correspondantes
            document.getElementById('roxwood-invoices').innerText = `Nombre de factures (RoxWood): ${roxwoodResults.invoices}`;
            document.getElementById('roxwood-revenue').innerText = `Chiffre d'affaire (RoxWood): ${roxwoodResults.revenue}€`;
            document.getElementById('roxwood-expenses').innerText = `Chiffre d'achat (RoxWood): ${roxwoodResults.expenses}€`;
            document.getElementById('roxwood-gross-profit').innerText = `Bénéfice brut (RoxWood): ${roxwoodResults.grossProfit}€`;
            document.getElementById('roxwood-net-profit').innerText = `Bénéfice net (RoxWood): ${roxwoodResults.grossProfit - roxwoodResults.salaries}€`;

            document.getElementById('paleto-invoices').innerText = `Nombre de factures (Paleto): ${paletoResults.invoices}`;
            document.getElementById('paleto-revenue').innerText = `Chiffre d'affaire (Paleto): ${paletoResults.revenue}€`;
            document.getElementById('paleto-expenses').innerText = `Chiffre d'achat (Paleto): ${paletoResults.expenses}€`;
            document.getElementById('paleto-gross-profit').innerText = `Bénéfice brut (Paleto): ${paletoResults.grossProfit}€`;
            document.getElementById('paleto-net-profit').innerText = `Bénéfice net (Paleto): ${paletoResults.grossProfit - paletoResults.salaries}€`;
        }

        // Lancer le script principal
        processEmployeeData();
    </script>

</body>
</html>
