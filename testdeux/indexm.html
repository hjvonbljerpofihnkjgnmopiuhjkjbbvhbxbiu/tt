<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapport Employés</title>
</head>
<body>
    <h1>Rapport Employés RoxWood et Paleto</h1>

    <div id="roxwood-results">
        <h2>Résultats pour RoxWood</h2>
        <div id="roxwood-invoices"></div>
        <div id="roxwood-revenue"></div>
        <div id="roxwood-cost"></div>
        <div id="roxwood-gross-profit"></div>
        <div id="roxwood-net-profit"></div>
    </div>

    <div id="paleto-results">
        <h2>Résultats pour Paleto</h2>
        <div id="paleto-invoices"></div>
        <div id="paleto-revenue"></div>
        <div id="paleto-cost"></div>
        <div id="paleto-gross-profit"></div>
        <div id="paleto-net-profit"></div>
    </div>

    <script>
        const tableau1Url = 'https://docs.google.com/spreadsheets/d/1M19pAtJYNnDCaKxhO5XjWIlxqT7p2zvk6FHqKYVBJ1g/export?format=csv&gid=821726330';
        const tableau2Url = 'https://docs.google.com/spreadsheets/d/1M19pAtJYNnDCaKxhO5XjWIlxqT7p2zvk6FHqKYVBJ1g/export?format=csv&gid=582059801';

        async function fetchCSV(url) {
            const response = await fetch(url);
            const data = await response.text();
            return data.split('\n').map(row => row.split(','));
        }

        async function processData() {
            const [tableau1, tableau2] = await Promise.all([fetchCSV(tableau1Url), fetchCSV(tableau2Url)]);

            // Traitement des données du tableau 1
            const roxwoodIds = new Set();
            const paletoIds = new Set();

            for (let i = 3; i < tableau1.length && i < 43; i++) {
                const row = tableau1[i];
                const id = row[3];  // Colonne D (Index 3)
                const isRoxwood = row[22] === 'TRUE';  // Colonne W (Index 22)

                if (id) {
                    if (isRoxwood) {
                        roxwoodIds.add(id);
                        console.log(`Employé RoxWood trouvé : ${id}`);
                    } else {
                        paletoIds.add(id);
                        console.log(`Employé Paleto trouvé : ${id}`);
                    }
                }
            }

            // Traitement des données du tableau 2
            const resultsRoxwood = {
                invoices: 0,
                revenue: 0,
                cost: 0,
                grossProfit: 0,
                netProfit: 0,
            };

            const resultsPaleto = {
                invoices: 0,
                revenue: 0,
                cost: 0,
                grossProfit: 0,
                netProfit: 0,
            };

            for (let i = 6; i < tableau2.length && i < 46; i++) {
                const row = tableau2[i];
                const id = row[2];  // Colonne C (Index 2)

                if (roxwoodIds.has(id)) {
                    resultsRoxwood.invoices += parseFloat(row[4]) || 0;  // Colonne E (Index 4)
                    resultsRoxwood.revenue += parseFloat(row[5]) || 0;   // Colonne F (Index 5)
                    resultsRoxwood.cost += parseFloat(row[7]) || 0;      // Colonne H (Index 7)
                    resultsRoxwood.grossProfit += parseFloat(row[9]) || 0;  // Colonne J (Index 9)
                    console.log(`Données pour RoxWood avec ID ${id} ajoutées : Factures ${row[4]}, Chiffre d'affaires ${row[5]}, Chiffre d'achat ${row[7]}, Bénéfice ${row[9]}`);
                }

                if (paletoIds.has(id)) {
                    resultsPaleto.invoices += parseFloat(row[4]) || 0;  // Colonne E (Index 4)
                    resultsPaleto.revenue += parseFloat(row[5]) || 0;   // Colonne F (Index 5)
                    resultsPaleto.cost += parseFloat(row[7]) || 0;      // Colonne H (Index 7)
                    resultsPaleto.grossProfit += parseFloat(row[9]) || 0;  // Colonne J (Index 9)
                    console.log(`Données pour Paleto avec ID ${id} ajoutées : Factures ${row[4]}, Chiffre d'affaires ${row[5]}, Chiffre d'achat ${row[7]}, Bénéfice ${row[9]}`);
                }
            }

            // Calcul du bénéfice net
            resultsRoxwood.netProfit = resultsRoxwood.grossProfit - Array.from(roxwoodIds).reduce((sum, id) => {
                const employeeRow = tableau2.find(row => row[2] === id);
                return sum + (employeeRow ? parseFloat(employeeRow[22]) || 0 : 0);  // Colonne W (Index 22)
            }, 0);

            resultsPaleto.netProfit = resultsPaleto.grossProfit - Array.from(paletoIds).reduce((sum, id) => {
                const employeeRow = tableau2.find(row => row[2] === id);
                return sum + (employeeRow ? parseFloat(employeeRow[22]) || 0 : 0);  // Colonne W (Index 22)
            }, 0);

            // Affichage des résultats
            document.getElementById('roxwood-invoices').innerText = `Total Factures RoxWood : ${resultsRoxwood.invoices}`;
            document.getElementById('roxwood-revenue').innerText = `Total Chiffre d'affaires RoxWood : ${resultsRoxwood.revenue}`;
            document.getElementById('roxwood-cost').innerText = `Total Chiffre d'achat RoxWood : ${resultsRoxwood.cost}`;
            document.getElementById('roxwood-gross-profit').innerText = `Bénéfice Brut RoxWood : ${resultsRoxwood.grossProfit}`;
            document.getElementById('roxwood-net-profit').innerText = `Bénéfice Net RoxWood : ${resultsRoxwood.netProfit}`;

            document.getElementById('paleto-invoices').innerText = `Total Factures Paleto : ${resultsPaleto.invoices}`;
            document.getElementById('paleto-revenue').innerText = `Total Chiffre d'affaires Paleto : ${resultsPaleto.revenue}`;
            document.getElementById('paleto-cost').innerText = `Total Chiffre d'achat Paleto : ${resultsPaleto.cost}`;
            document.getElementById('paleto-gross-profit').innerText = `Bénéfice Brut Paleto : ${resultsPaleto.grossProfit}`;
            document.getElementById('paleto-net-profit').innerText = `Bénéfice Net Paleto : ${resultsPaleto.netProfit}`;
        }

        processData().catch(error => {
            console.error('Erreur lors du traitement des données :', error);
        });
    </script>
</body>
</html>
