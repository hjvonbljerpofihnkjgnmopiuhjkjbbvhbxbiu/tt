<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyse des Employés RoxWood et Paleto</title>
    <style>
        .result {
            margin: 10px;
            padding: 10px;
            border: 1px solid black;
        }
    </style>
</head>
<body>

    <h1>Analyse des Employés RoxWood et Paleto</h1>

    <div id="roxwood-results" class="result">
        <h2>RoxWood</h2>
        <p id="roxwood-factures">Total Factures: </p>
        <p id="roxwood-chiffre-affaire">Chiffre d'Affaire: </p>
        <p id="roxwood-chiffre-achat">Chiffre d'Achat: </p>
        <p id="roxwood-benefice-brut">Bénéfice Brut: </p>
        <p id="roxwood-benefice-net">Bénéfice Net: </p>
    </div>

    <div id="paleto-results" class="result">
        <h2>Paleto</h2>
        <p id="paleto-factures">Total Factures: </p>
        <p id="paleto-chiffre-affaire">Chiffre d'Affaire: </p>
        <p id="paleto-chiffre-achat">Chiffre d'Achat: </p>
        <p id="paleto-benefice-brut">Bénéfice Brut: </p>
        <p id="paleto-benefice-net">Bénéfice Net: </p>
    </div>

    <script>
        // URLs des CSV des Google Sheets
        const urlTableau1 = 'https://docs.google.com/spreadsheets/d/1M19pAtJYNnDCaKxhO5XjWIlxqT7p2zvk6FHqKYVBJ1g/export?format=csv&gid=821726330';
        const urlTableau2 = 'https://docs.google.com/spreadsheets/d/1M19pAtJYNnDCaKxhO5XjWIlxqT7p2zvk6FHqKYVBJ1g/export?format=csv&gid=582059801';

        async function fetchCSV(url) {
            console.log(`Fetching data from: ${url}`);
            const response = await fetch(url);
            const data = await response.text();
            return data.split('\n').map(row => row.split(','));
        }

        async function processData() {
            const tableau1 = await fetchCSV(urlTableau1);
            const tableau2 = await fetchCSV(urlTableau2);

            // Récupérer les identifiants des employés RoxWood et Paleto
            const roxwoodIds = [];
            const paletoIds = [];

            for (let i = 3; i <= 43; i++) { // Parcours des lignes du Tableau1 D3:W43
                const employerId = tableau1[i][3]; // Colonne D
                const isRoxWood = tableau1[i][20] === 'TRUE'; // Colonne W
                if (isRoxWood) {
                    roxwoodIds.push(employerId);
                } else {
                    paletoIds.push(employerId);
                }
            }

            console.log(`Employés RoxWood trouvés: ${roxwoodIds}`);
            console.log(`Employés Paleto trouvés: ${paletoIds}`);

            // Calculs pour RoxWood
            let roxwoodFactures = 0, roxwoodChiffreAffaire = 0, roxwoodChiffreAchat = 0, roxwoodBeneficeBrut = 0, roxwoodSalaires = 0;

            for (let i = 6; i <= 46; i++) { // Parcours des lignes du Tableau2 B6:W46
                const employerId = tableau2[i][2]; // Colonne C
                if (roxwoodIds.includes(employerId)) {
                    roxwoodFactures += parseFloat(tableau2[i][4] || 0); // Colonne E
                    roxwoodChiffreAffaire += parseFloat(tableau2[i][5] || 0); // Colonne F
                    roxwoodChiffreAchat += parseFloat(tableau2[i][7] || 0); // Colonne H
                    roxwoodBeneficeBrut += parseFloat(tableau2[i][9] || 0); // Colonne J
                    roxwoodSalaires += parseFloat(tableau2[i][22] || 0); // Colonne W
                }
            }

            // Affichage des résultats pour RoxWood
            document.getElementById('roxwood-factures').innerText += roxwoodFactures;
            document.getElementById('roxwood-chiffre-affaire').innerText += roxwoodChiffreAffaire;
            document.getElementById('roxwood-chiffre-achat').innerText += roxwoodChiffreAchat;
            document.getElementById('roxwood-benefice-brut').innerText += roxwoodBeneficeBrut;
            document.getElementById('roxwood-benefice-net').innerText += roxwoodBeneficeBrut - roxwoodSalaires;

            // Calculs pour Paleto
            let paletoFactures = 0, paletoChiffreAffaire = 0, paletoChiffreAchat = 0, paletoBeneficeBrut = 0, paletoSalaires = 0;

            for (let i = 6; i <= 46; i++) { // Parcours des lignes du Tableau2 B6:W46
                const employerId = tableau2[i][2]; // Colonne C
                if (paletoIds.includes(employerId)) {
                    paletoFactures += parseFloat(tableau2[i][4] || 0); // Colonne E
                    paletoChiffreAffaire += parseFloat(tableau2[i][5] || 0); // Colonne F
                    paletoChiffreAchat += parseFloat(tableau2[i][7] || 0); // Colonne H
                    paletoBeneficeBrut += parseFloat(tableau2[i][9] || 0); // Colonne J
                    paletoSalaires += parseFloat(tableau2[i][22] || 0); // Colonne W
                }
            }

            // Affichage des résultats pour Paleto
            document.getElementById('paleto-factures').innerText += paletoFactures;
            document.getElementById('paleto-chiffre-affaire').innerText += paletoChiffreAffaire;
            document.getElementById('paleto-chiffre-achat').innerText += paletoChiffreAchat;
            document.getElementById('paleto-benefice-brut').innerText += paletoBeneficeBrut;
            document.getElementById('paleto-benefice-net').innerText += paletoBeneficeBrut - paletoSalaires;

            console.log('Calculs et affichage des résultats terminés.');
        }

        // Lancer le traitement des données
        processData().catch(error => console.error('Erreur lors du traitement des données:', error));
    </script>

</body>
</html>
