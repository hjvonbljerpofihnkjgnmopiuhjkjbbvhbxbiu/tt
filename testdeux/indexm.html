<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyse des Employés</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .result { margin: 10px 0; }
    </style>
</head>
<body>

    <h1>Analyse des Employés de RoxWood et Paleto</h1>
    
    <div class="result" id="roxwood-factures"></div>
    <div class="result" id="roxwood-chiffre-affaire"></div>
    <div class="result" id="roxwood-chiffre-achat"></div>
    <div class="result" id="roxwood-benefice-brut"></div>
    <div class="result" id="roxwood-benefice-net"></div>
    
    <div class="result" id="paleto-factures"></div>
    <div class="result" id="paleto-chiffre-affaire"></div>
    <div class="result" id="paleto-chiffre-achat"></div>
    <div class="result" id="paleto-benefice-brut"></div>
    <div class="result" id="paleto-benefice-net"></div>

    <script>
        const tableau1Url = 'https://docs.google.com/spreadsheets/d/1M19pAtJYNnDCaKxhO5XjWIlxqT7p2zvk6FHqKYVBJ1g/export?format=csv&gid=821726330';
        const tableau2Url = 'https://docs.google.com/spreadsheets/d/1M19pAtJYNnDCaKxhO5XjWIlxqT7p2zvk6FHqKYVBJ1g/export?format=csv&gid=582059801';

        async function fetchCSV(url) {
            const response = await fetch(url);
            const text = await response.text();
            const data = text.split('\n').map(row => row.split(','));
            return data;
        }

        function filterRoxwoodAndPaleto(tableau1, tableau2) {
            const roxwoodIds = [];
            const paletoIds = [];
            const roxwoodData = {};
            const paletoData = {};

            // Récupération des IDs selon le booléen
            for (let i = 3; i < tableau1.length; i++) {
                const id = tableau1[i][3]; // colonne D
                const isRoxwood = tableau1[i][22].toLowerCase() === 'true'; // colonne W
                if (id) {
                    if (isRoxwood) {
                        roxwoodIds.push(id);
                        roxwoodData[id] = {};
                    } else {
                        paletoIds.push(id);
                        paletoData[id] = {};
                    }
                }
            }

            // Récupération des données selon les IDs
            for (let i = 6; i < tableau2.length; i++) {
                const id = tableau2[i][2]; // colonne C
                if (roxwoodIds.includes(id)) {
                    roxwoodData[id] = {
                        factures: parseFloat(tableau2[i][4]) || 0,
                        chiffreAffaire: parseFloat(tableau2[i][5]) || 0,
                        chiffreAchat: parseFloat(tableau2[i][7]) || 0,
                        benefice: parseFloat(tableau2[i][9]) || 0,
                        salaire: parseFloat(tableau2[i][22]) || 0,
                    };
                } else if (paletoIds.includes(id)) {
                    paletoData[id] = {
                        factures: parseFloat(tableau2[i][4]) || 0,
                        chiffreAffaire: parseFloat(tableau2[i][5]) || 0,
                        chiffreAchat: parseFloat(tableau2[i][7]) || 0,
                        benefice: parseFloat(tableau2[i][9]) || 0,
                        salaire: parseFloat(tableau2[i][22]) || 0,
                    };
                }
            }

            return { roxwoodData, paletoData };
        }

        function calculateResults(data, company) {
            let totalFactures = 0;
            let totalChiffreAffaire = 0;
            let totalChiffreAchat = 0;
            let totalBeneficeBrut = 0;
            let totalSalaires = 0;

            for (const id in data) {
                totalFactures += data[id].factures;
                totalChiffreAffaire += data[id].chiffreAffaire;
                totalChiffreAchat += data[id].chiffreAchat;
                totalBeneficeBrut += data[id].benefice;
                totalSalaires += data[id].salaire;
            }

            const beneficeNet = totalBeneficeBrut - totalSalaires;

            // Affichage des résultats
            document.getElementById(`${company}-factures`).innerText = `Total Factures (${company}): ${totalFactures}`;
            document.getElementById(`${company}-chiffre-affaire`).innerText = `Total Chiffre d'Affaire (${company}): ${totalChiffreAffaire}`;
            document.getElementById(`${company}-chiffre-achat`).innerText = `Total Chiffre d'Achat (${company}): ${totalChiffreAchat}`;
            document.getElementById(`${company}-benefice-brut`).innerText = `Bénéfice Brut (${company}): ${totalBeneficeBrut}`;
            document.getElementById(`${company}-benefice-net`).innerText = `Bénéfice Net (${company}): ${beneficeNet}`;
        }

        async function main() {
            console.log("Début de l'exécution du script...");

            const [tableau1, tableau2] = await Promise.all([
                fetchCSV(tableau1Url),
                fetchCSV(tableau2Url)
            ]);

            console.log("Données des tableaux récupérées.");

            const { roxwoodData, paletoData } = filterRoxwoodAndPaleto(tableau1, tableau2);

            console.log("Données filtrées pour RoxWood et Paleto.");

            calculateResults(roxwoodData, 'roxwood');
            calculateResults(paletoData, 'paleto');

            console.log("Calculs terminés et résultats affichés.");
        }

        main().catch(error => console.error("Erreur lors de l'exécution du script:", error));
    </script>
</body>
</html>
