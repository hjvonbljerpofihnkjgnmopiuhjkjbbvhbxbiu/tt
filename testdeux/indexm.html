<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calcul des Employés</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .result {
            margin: 10px 0;
        }
        .log {
            margin-top: 20px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>Calcul des Employés de RoxWood et Paleto</h1>

    <div class="result">
        <h2>RoxWood</h2>
        <div id="roxwood-factures">Total Factures: </div>
        <div id="roxwood-chiffre-affaire">Total Chiffre d'Affaire: </div>
        <div id="roxwood-chiffre-achat">Total Chiffre d'Achat: </div>
        <div id="roxwood-benefice-brut">Bénéfice Brut: </div>
        <div id="roxwood-benefice-net">Bénéfice Net: </div>
    </div>

    <div class="result">
        <h2>Paleto</h2>
        <div id="paleto-factures">Total Factures: </div>
        <div id="paleto-chiffre-affaire">Total Chiffre d'Affaire: </div>
        <div id="paleto-chiffre-achat">Total Chiffre d'Achat: </div>
        <div id="paleto-benefice-brut">Bénéfice Brut: </div>
        <div id="paleto-benefice-net">Bénéfice Net: </div>
    </div>

    <div class="log" id="log"></div>

    <script>
        async function fetchData(url) {
            const response = await fetch(url);
            const data = await response.text();
            return data.split('\n').map(row => row.split(','));
        }

        async function calculate() {
            const tableau1Url = 'https://docs.google.com/spreadsheets/d/1M19pAtJYNnDCaKxhO5XjWIlxqT7p2zvk6FHqKYVBJ1g/export?format=csv&gid=821726330';
            const tableau2Url = 'https://docs.google.com/spreadsheets/d/1M19pAtJYNnDCaKxhO5XjWIlxqT7p2zvk6FHqKYVBJ1g/export?format=csv&gid=582059801';

            const tableau1 = await fetchData(tableau1Url);
            const tableau2 = await fetchData(tableau2Url);

            const roxwoodIds = tableau1
                .filter(row => row[3] && row[22] === 'TRUE') // D is index 3, W is index 22
                .map(row => row[3]);

            const paletoIds = tableau1
                .filter(row => row[3] && row[22] === 'FALSE') // D is index 3, W is index 22
                .map(row => row[3]);

            console.log("Identifiants RoxWood:", roxwoodIds);
            console.log("Identifiants Paleto:", paletoIds);

            const roxwoodData = tableau2.filter(row => roxwoodIds.includes(row[2])); // C is index 2
            const paletoData = tableau2.filter(row => paletoIds.includes(row[2])); // C is index 2

            function sumValues(data, index) {
                return data.reduce((total, row) => total + (parseFloat(row[index]) || 0), 0);
            }

            // Calcul pour RoxWood
            const roxwoodFactures = sumValues(roxwoodData, 4); // E is index 4
            const roxwoodChiffreAffaire = sumValues(roxwoodData, 5); // F is index 5
            const roxwoodChiffreAchat = sumValues(roxwoodData, 7); // H is index 7
            const roxwoodBenefice = sumValues(roxwoodData, 9); // J is index 9
            const roxwoodSalaires = sumValues(roxwoodData, 22); // W is index 22

            // Affichage des résultats
            document.getElementById('roxwood-factures').innerText += roxwoodFactures;
            document.getElementById('roxwood-chiffre-affaire').innerText += roxwoodChiffreAffaire;
            document.getElementById('roxwood-chiffre-achat').innerText += roxwoodChiffreAchat;
            document.getElementById('roxwood-benefice-brut').innerText += roxwoodBenefice;

            const roxwoodBeneficeNet = roxwoodBenefice - roxwoodSalaires;
            document.getElementById('roxwood-benefice-net').innerText += roxwoodBeneficeNet;

            // Calcul pour Paleto
            const paletoFactures = sumValues(paletoData, 4); // E is index 4
            const paletoChiffreAffaire = sumValues(paletoData, 5); // F is index 5
            const paletoChiffreAchat = sumValues(paletoData, 7); // H is index 7
            const paletoBenefice = sumValues(paletoData, 9); // J is index 9
            const paletoSalaires = sumValues(paletoData, 22); // W is index 22

            // Affichage des résultats
            document.getElementById('paleto-factures').innerText += paletoFactures;
            document.getElementById('paleto-chiffre-affaire').innerText += paletoChiffreAffaire;
            document.getElementById('paleto-chiffre-achat').innerText += paletoChiffreAchat;
            document.getElementById('paleto-benefice-brut').innerText += paletoBenefice;

            const paletoBeneficeNet = paletoBenefice - paletoSalaires;
            document.getElementById('paleto-benefice-net').innerText += paletoBeneficeNet;

            // Log des actions effectuées
            document.getElementById('log').innerText = `
            Calculs effectués avec succès.
            Identifiants RoxWood: ${roxwoodIds.join(', ')}
            Total Factures RoxWood: ${roxwoodFactures}
            Total Chiffre d'Affaire RoxWood: ${roxwoodChiffreAffaire}
            Total Chiffre d'Achat RoxWood: ${roxwoodChiffreAchat}
            Bénéfice Brut RoxWood: ${roxwoodBenefice}
            Bénéfice Net RoxWood: ${roxwoodBeneficeNet}

            Identifiants Paleto: ${paletoIds.join(', ')}
            Total Factures Paleto: ${paletoFactures}
            Total Chiffre d'Affaire Paleto: ${paletoChiffreAffaire}
            Total Chiffre d'Achat Paleto: ${paletoChiffreAchat}
            Bénéfice Brut Paleto: ${paletoBenefice}
            Bénéfice Net Paleto: ${paletoBeneficeNet}
            `;
        }

        calculate();
    </script>
</body>
</html>
