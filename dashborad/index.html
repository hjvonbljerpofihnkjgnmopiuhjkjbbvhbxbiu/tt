<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Simple</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212; /* Couleur de fond en mode nuit */
            color: #ffffff; /* Couleur du texte */
            margin: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        .dashboard {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        table {
            width: 80%;
            border-collapse: collapse;
            margin: 20px 0;
            table-layout: auto;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
            font-size: 16px;
        }

        th {
            background-color: #1e1e1e; /* Couleur d'en-tête */
            font-weight: bold;
        }

        tr:nth-child(even) {
            background-color: #282828; /* Couleur des lignes paires */
        }

        tr:hover {
            background-color: #444444; /* Couleur des lignes au survol */
        }

        .result {
            margin-top: 20px;
            padding: 10px;
            background-color: #1e1e1e;
            border-radius: 5px;
            width: 80%;
        }

        .result h2 {
            margin: 0;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <h1>Dashboard Simple</h1>
        <div id="sales-data"></div>
        <div id="data-table"></div>
        <div id="search-result" class="result"></div>
    </div>

    <script>
        async function fetchCSVData(url) {
            const response = await fetch(url);
            if (!response.ok) throw new Error('Erreur de récupération des données');
            const data = await response.text();
            return data;
        }

        function parseSalesData(csv) {
            const lines = csv.split("\n");
            const filteredLines = lines.slice(28, 34); // Ligne Y29 à AB34 (index 28 à 33)
            const headers = filteredLines[0].split(",");
            const rows = filteredLines.slice(1).map(line => line.split(","));
            return { headers, rows };
        }

        function parseAndCleanData(csv) {
            const lines = csv.split("\n");
            const filteredLines = lines.slice(4, 36); // Ligne B5 à W36 (index 4 à 35)

            const cleanedData = filteredLines.map(line => {
                const cells = line.split(",");
                // Supprimer les colonnes vides G (index 6), I (index 8), M (index 12), P (index 15), U (index 20)
                return [
                    cells[0],  // Colonne A
                    cells[1],  // Colonne B
                    cells[2],  // Colonne C
                    cells[3],  // Colonne D
                    cells[4],  // Colonne E
                    cells[5],  // Colonne F
                    cells[7],  // Colonne H (index 6 est G, on saute G)
                    cells[9],  // Colonne J (index 8 est I, on saute I)
                    cells[10], // Colonne K
                    cells[11], // Colonne L
                    cells[13], // Colonne N (index 12 est M, on saute M)
                    cells[14], // Colonne O
                    cells[16], // Colonne Q (index 15 est P, on saute P)
                    cells[17], // Colonne R
                    cells[18], // Colonne S
                    cells[19], // Colonne T
                    cells[21], // Colonne V (index 20 est U, on saute U)
                    cells[22]  // Colonne W
                ].filter(cell => cell && cell.trim() !== ""); // Filtrer les cellules vides
            }).filter(row => row.length > 0); // Garder uniquement les lignes non vides

            return cleanedData;
        }

        function displaySalesData({ headers, rows }) {
            const salesDataDiv = document.getElementById("sales-data");
            const table = document.createElement("table");
            const headerRow = document.createElement("tr");

            headers.forEach(header => {
                const th = document.createElement("th");
                th.textContent = header;
                headerRow.appendChild(th);
            });

            table.appendChild(headerRow);
            rows.forEach(row => {
                const tr = document.createElement("tr");
                row.forEach(cell => {
                    const td = document.createElement("td");
                    td.textContent = cell;
                    tr.appendChild(td);
                });
                table.appendChild(tr);
            });

            salesDataDiv.appendChild(table);
        }

        function displayCleanedData(data) {
            const dataTableDiv = document.getElementById("data-table");
            const table = document.createElement("table");
            const headerRow = document.createElement("tr");

            const headers = ["Colonne A", "Colonne B", "Colonne C", "Colonne D", "Colonne E", "Colonne F", "Colonne H", "Colonne J", "Colonne K", "Colonne L", "Colonne N", "Colonne O", "Colonne Q", "Colonne R", "Colonne S", "Colonne T", "Colonne V", "Colonne W"];
            headers.forEach(header => {
                const th = document.createElement("th");
                th.textContent = header;
                headerRow.appendChild(th);
            });

            table.appendChild(headerRow);
            data.forEach(row => {
                const tr = document.createElement("tr");
                row.forEach(cell => {
                    const td = document.createElement("td");
                    td.textContent = cell;
                    tr.appendChild(td);
                });
                table.appendChild(tr);
            });

            dataTableDiv.appendChild(table);
        }

        function searchForNumber(data, numberToSearch) {
            // Recherche dans la colonne C
            const index = data.findIndex(row => row[2]?.trim() === numberToSearch); 
            const resultDiv = document.getElementById("search-result");
            if (index !== -1) {
                const foundRow = data[index];
                resultDiv.innerHTML = `<h2>Résultats pour ${numberToSearch} :</h2><p>${foundRow.join(", ")}</p>`;
            } else {
                resultDiv.innerHTML = `<h2>Aucun résultat trouvé pour ${numberToSearch}.</h2>`;
            }
        }

        async function loadDashboard() {
            try {
                // URL de la première feuille (Chiffre d'affaires)
                const salesDataUrl = 'https://docs.google.com/spreadsheets/d/1M19pAtJYNnDCaKxhO5XjWIlxqT7p2zvk6FHqKYVBJ1g/export?format=csv&gid=949312380';
                const salesDataCSV = await fetchCSVData(salesDataUrl);
                const salesData = parseSalesData(salesDataCSV);
                displaySalesData(salesData);

                // URL de la deuxième feuille (Données à nettoyer)
                const cleanDataUrl = 'https://docs.google.com/spreadsheets/d/1M19pAtJYNnDCaKxhO5XjWIlxqT7p2zvk6FHqKYVBJ1g/export?format=csv&gid=949312380';
                const cleanDataCSV = await fetchCSVData(cleanDataUrl);
                const cleanedData = parseAndCleanData(cleanDataCSV);
                displayCleanedData(cleanedData);

                // Recherche pour le numéro 57755
                searchForNumber(cleanedData, '57755');

            } catch (error) {
                console.error('Erreur lors du chargement du tableau de bord :', error);
            }
        }

        loadDashboard();
    </script>
</body>
</html>
